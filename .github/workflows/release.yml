name: Release Please

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pull-requests: write

jobs:
  release-please:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: googleapis/release-please-action@v4
        id: release
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # Output release information (for debugging)
      - name: Release outputs
        if: ${{ steps.release.outputs.releases_created }}
        env:
          RELEASE_DATA: ${{ toJSON(steps.release.outputs) }}
        run: |
          echo "Releases created: true"
          echo "Release data:"
          echo "$RELEASE_DATA"

# How it works:
# 1. On every push to main, Release Please analyzes commits
# 2. It looks for conventional commit messages (feat:, fix:, etc.)
# 3. If releasable changes are found, it:
#    a. Opens/updates a "Release PR" with changelog
#    b. When you merge the Release PR, it creates a git tag
#    c. The git tag triggers the docker-publish.yml workflow
#    d. Docker images are built with proper version tags
#
# Conventional Commit Format (use these as PR titles):
# - feat: new feature → bumps MINOR (1.0.0 → 1.1.0)
# - fix: bug fix → bumps PATCH (1.0.0 → 1.0.1)
# - feat!: breaking change → bumps MAJOR (1.0.0 → 2.0.0)
# - fix!: breaking bug fix → bumps MAJOR (1.0.0 → 2.0.0)
# - docs: documentation → no version bump
# - chore: maintenance → no version bump
# - refactor: code refactoring → no version bump
#
# Examples:
# ✅ "feat: add email template editor"
# ✅ "fix: resolve memory leak in worker process"
# ✅ "feat!: redesign API authentication"
# ✅ "fix: correct contact import validation"
# ❌ "Added new feature" (missing type prefix)
# ❌ "Bug fix" (missing type prefix)
